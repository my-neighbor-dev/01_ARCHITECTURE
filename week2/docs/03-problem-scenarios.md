# 3. 캐시로 해결할 수 있는 문제들

## 질문

> **"캐시를 활용해서 해결할 수 있는 실무 문제는 무엇이 있을까요?"**

> 💡 **스터디 전에 생각해보기**: [질문들 모음](./00-questions.md)을 먼저 확인해보세요!

**생각해볼 점:**
- 캐시의 특성은 무엇일까? (빠른 읽기/쓰기, TTL 기능, 분산 환경 등)
- 어떤 문제들이 캐시의 특성을 활용해서 해결할 수 있을까?
- 세션 관리, 임시 데이터 저장, 분산 락 등에서 캐시가 어떻게 도움이 될까?

---

## 3.1 캐시의 특성

**캐시의 핵심 특성:**

1. **빠른 읽기/쓰기**: 메모리 기반으로 매우 빠름
2. **TTL 기능**: 자동 만료 기능 (Time To Live)
3. **분산 환경**: 여러 서버에서 동일한 데이터 공유 가능
4. **단순한 키-값 구조**: 복잡한 쿼리 불필요

---

## 3.2 문제 상황들

### 1. 세션 관리: 로그인 상태 유지

**문제:**
- 사용자 로그인 상태를 서버에 저장해야 함
- 로그인 상태 확인이 자주 발생함
- 일정 시간 후 자동으로 만료되어야 함

**캐시 특성 연결:**
- **빠른 읽기/쓰기**: 로그인 상태 확인이 자주 발생하므로 빠른 접근 필요
- **TTL 기능**: 세션 만료 시간 자동 관리 (예: 30분 후 자동 삭제)
- **분산 환경**: 여러 서버에서 동일한 세션 정보 공유 가능

**구현 예시:**
```java
// 세션 저장
redis.set("session:user123", "logged_in", 1800); // 30분 TTL

// 세션 확인
String status = redis.get("session:user123");
```

---

### 2. 임시 데이터 저장: 인증 코드, OTP 등

**문제:**
- 인증 코드는 일정 시간 후 만료되어야 함
- 인증 코드 검증이 빠르게 이루어져야 함
- 영구 저장할 필요 없음

**캐시 특성 연결:**
- **TTL 기능**: 인증 코드 자동 만료 (예: 5분 후 자동 삭제)
- **빠른 읽기/쓰기**: 인증 코드 검증이 빠르게 이루어져야 함
- **단순한 키-값 구조**: 코드와 만료 시간만 저장하면 됨

**구현 예시:**
```java
// 인증 코드 저장
redis.set("otp:01012345678", "123456", 300); // 5분 TTL

// 인증 코드 검증
String code = redis.get("otp:01012345678");
if (code != null && code.equals(inputCode)) {
    // 인증 성공
    redis.delete("otp:01012345678");
}
```

---

### 3. 분산 락: 동시성 제어

**문제:**
- 여러 서버에서 동시에 같은 작업을 수행하면 안 됨
- 예: 주문 처리, 재고 차감 등

**캐시 특성 연결:**
- **분산 환경**: 여러 서버에서 동일한 락 정보 공유
- **빠른 읽기/쓰기**: 락 획득/해제가 빠르게 이루어져야 함
- **TTL 기능**: 락이 해제되지 않았을 때 자동 만료 (데드락 방지)

**구현 예시:**
```java
// 락 획득 시도
boolean acquired = redis.setIfAbsent("lock:order:123", "server1", 60);
if (acquired) {
    try {
        // 주문 처리
    } finally {
        redis.delete("lock:order:123");
    }
}
```

---

## 3.3 오늘 다룰 문제: 무분별한 로그인 시도 방지

**문제:**
- Brute-force 공격: 무분별한 로그인 시도
- 1시간에 5번만 로그인 요청 가능
- 시간이 지나면 제한이 해제되어야 함

**캐시 특성 연결:**
- **TTL 기능**: 1시간 후 자동으로 제한 해제
- **빠른 읽기/쓰기**: 로그인 시도마다 빠르게 체크
- **단순한 키-값 구조**: 횟수만 저장하면 됨

**이 문제를 예시로 Rate Limiting을 구현해보겠습니다!**

---

## 정리

✅ **캐시의 특성(빠른 읽기/쓰기, TTL, 분산 환경)을 이해하면 활용 범위가 넓어진다**

✅ **세션 관리, 임시 데이터 저장, 분산 락 등 다양한 문제를 캐시로 해결할 수 있다**

✅ **오늘은 무분별한 로그인 시도 방지를 예시로 Rate Limiting을 구현한다**
