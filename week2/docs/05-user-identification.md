# 5. 사용자 식별

## 질문

> **"사용자를 식별하려면 어떻게 해야 할까요?"**

> 💡 **스터디 전에 생각해보기**: [질문들 모음](./00-questions.md)을 먼저 확인해보세요!

**생각해볼 점:**
- Rate Limiting을 위해 사용자를 식별해야 하는데, 어떤 값으로 식별할 수 있을까?
- 로그인 전에는 사용자 ID를 알 수 없는데, 어떻게 식별할까?

---

## 5.1 문제: 사용자 식별

**상황:**
- Rate Limiting을 위해 사용자를 식별해야 함
- 로그인 전에는 사용자 ID를 알 수 없음
- 어떤 값으로 식별할 수 있을까?

---

## 5.2 식별 옵션들

### 1. 사용자 ID

**문제:**
- 로그인 전에는 알 수 없음
- Rate Limiting은 로그인 시도 전에 체크해야 함

**결론:** ❌ 사용 불가

---

### 2. 이메일

**장점:**
- 로그인 시도 시 입력값으로 사용 가능
- 명확한 식별

**단점:**
- 이메일 변경 시 이력 사라짐
- 여러 계정으로 공격 가능

**결론:** ⚠️ 사용 가능하지만 제한적

---

### 3. 전화번호

**장점:**
- 로그인 시도 시 로그인한 사용자의 유일한 값으로 사용 가능
- 명확한 식별
- 이메일보다 변경 빈도 낮음

**단점:**
- 전화번호 변경 시 이력 사라짐
- 여러 계정으로 공격 가능

**결론:** ✅ 사용 가능

---

### 4. Device ID

**장점:**
- 장치 기반 제한
- 쿠키로 관리 가능
- 사용자가 변경하기 어려움

**단점:**
- 쿠키 삭제 시 새 Device ID 생성 가능

**결론:** ✅ 추가 보안 수단으로 사용 가능

---

### 5. IP 주소

**장점:**
- 요청에서 쉽게 추출 가능

**단점:**
- 변경 가능 (VPN, 모바일 데이터 등)
- 공유 IP 문제 (회사, 학교 등)
- 여러 사용자가 같은 IP 사용 가능

**결론:** ⚠️ 보조 수단으로만 사용

---

## 5.3 선택: 전화번호

**구현:**
```java
public void checkPhoneRateLimit(String phoneNumber) {
    String key = "rate_limit:login:phone:" + phoneNumber;
    Long count = redis.increment(key);
    
    if (count == 1) {
        redis.expire(key, 3600); // 1시간
    }
    
    if (count > 5) {
        throw new RateLimitExceededException("1시간에 5번만 로그인 가능합니다");
    }
}
```

**Key 예시:**
- `rate_limit:login:phone:01012345678`

---

## 5.4 전화번호만으로는 부족한 이유

**문제 상황:**
- 공격자가 여러 계정으로 로그인 시도
- 각 계정마다 전화번호가 다름
- 전화번호만으로는 막을 수 없음

**예시:**
```
공격자 A:
- 계정 1: 010-1111-1111 (5번 시도)
- 계정 2: 010-2222-2222 (5번 시도)
- 계정 3: 010-3333-3333 (5번 시도)
...
총 15번 이상 시도 가능!
```

**결론:**
- 전화번호만으로는 여러 계정 공격을 막을 수 없음
- 추가적인 식별 수단이 필요함

---

## 정리

✅ **로그인 전에는 사용자 ID를 알 수 없으므로 전화번호를 사용한다**

✅ **전화번호는 명확한 식별이 가능하지만, 여러 계정 공격을 막기에는 부족하다**

✅ **추가적인 식별 수단(Device ID, IP)이 필요하다**
